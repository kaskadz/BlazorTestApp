@page "/user-info"
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using System.Security.Claims
@using System.Text.Json
@inject IAccessTokenProvider _accessTokenProvider

<AuthorizeView>
    <h1>User info</h1>
    
    <p>Login: @context.User.Identity.Name</p>
    <p>Token: @Token</p>
    <p>ClaimsPrincipal:
    <code>
        @(GetClaimsPrincipalString(context.User))
    </code>
    </p>
</AuthorizeView>

@code {
    public string Token { get; set; }

    protected override async Task OnInitializedAsync()
    {
        AccessTokenResult accessTokenResult = await _accessTokenProvider.RequestAccessToken();
        if (accessTokenResult != null)
        {
            Token = accessTokenResult.TryGetToken(out AccessToken token)
                ? token?.Value
                : "no token";
        }
    }

    private static string GetClaimsPrincipalString(ClaimsPrincipal claimsPrincipal)
    {
        return JsonSerializer.Serialize(claimsPrincipal);
    }
}